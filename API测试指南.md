# API测试脚本使用指南

## 概述

`api-test.bat` 是一个轻量级API测试脚本，用于自动化测试 Checkout 系统的REST API端点。该脚本使用curl命令发送HTTP请求，并验证响应状态码和内容是否符合预期。

## 前提条件

1. Windows操作系统
2. 已安装curl工具（Windows 10以上版本通常已预装）
3. Checkout应用程序已启动并运行在本地端口8080上

## 使用方法

### 运行测试

1. 启动Checkout应用程序（使用`run.bat`）
2. 在命令行中运行测试脚本：
   ```
   api-test.bat
   ```
3. 等待测试完成，查看测试结果

### 输出说明

脚本将在控制台输出彩色测试结果，并将详细日志保存到`api-test-results.txt`文件中。

- 绿色✓：测试通过
- 红色✗：测试失败
- 黄色：警告信息和总结数据

## 测试内容

脚本会自动测试以下API端点：

### 基础测试
- 健康检查接口 (`/test/hello`)

### 客户API测试
- 获取所有产品列表 (`/customer/products`)
- 创建新购物车 (`/customer/cart`)
- 获取产品详情 (`/customer/products/{id}`)
- 添加商品到购物车 (`/customer/cart/{cartId}/items`)
- 查看购物车内容 (`/customer/cart/{cartId}`)

### 管理员API测试
- 管理员登录验证
- 创建新产品 (`/admin/products`)
- 更新产品 (`/admin/products/{id}`)
- 获取更新后的产品 (`/admin/products/{id}`)
- 删除产品 (`/admin/products/{id}`)
- 验证产品已删除
- 获取所有折扣 (`/admin/discounts`)

## 工作原理

1. **测试流程**：
   - 脚本设置基本环境变量
   - 依次测试各个API端点
   - 根据前一测试的结果决定后续测试内容（例如，使用创建的购物车ID进行后续测试）
   - 生成测试报告

2. **关键功能**：
   - 自动提取响应中的ID值用于后续测试
   - 验证HTTP状态码是否符合预期
   - 支持彩色输出，提高可读性
   - 详细日志记录

3. **测试依赖关系**：
   - 购物车相关测试依赖于成功创建购物车
   - 产品更新和删除测试依赖于成功创建产品

## 自定义配置

如需修改测试配置，可编辑脚本中以下变量：

```bat
:: 设置基本变量
set API_BASE=http://localhost:8080/api
```

## 故障排除

1. **curl命令未找到**：确保curl已安装，或下载Windows版curl并放置在系统PATH目录中
2. **连接错误**：检查应用程序是否正在运行，以及端口配置是否正确
3. **认证失败**：验证管理员用户名和密码是否正确（默认为admin/admin）

## 扩展功能

该脚本可以进一步扩展：

1. 添加更多API端点测试
2. 添加响应内容验证
3. 添加命令行参数支持自定义测试范围
4. 添加性能测试功能

---

如有任何问题或建议，请联系系统管理员。 